<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.battcn.platform.mapper.pub.AuthMapper">
	<!-- <cache eviction="LRU" flushInterval="60000" size="1024" readOnly="true" /> -->

	<select id="getParentMenu" parameterType="String"
		resultType="com.alibaba.fastjson.JSONObject">
		select * from t_sys_menu a
		<where>
			a.state = 1
			<if test="menuid != null and menuid != ''">
				and a.pid = #{menuid}
			</if>
			<if test="menuid == null or menuid == ''">
				and a.pid is null
			</if>
		</where>
		order by a.ordno
	</select>


	<select id="getChildMenuInPermission" parameterType="com.alibaba.fastjson.JSONObject"
		resultType="com.alibaba.fastjson.JSONObject" useCache="false">
		select a.* from t_sys_menu a left join t_sys_operate b on (a.id =
		b.menu ) left join t_sys_role_operate c on (b.menu = c.menu and b.op =
		c.op) left join t_sys_role d on (c.role = d.id) left join
		t_sys_manager f
		on (d.id = f.role) where f.managerid = #{accountid} and b.op = 'list'
		and a.state = 1
		<if test="menuid != null and menuid != ''">
			and a.pid = #{menuid}
		</if>
		<if test="menuid == null or menuid == ''">
			and a.pid is null
		</if>
		order by a.ordno
	</select>


	<select id="checkPermission" parameterType="com.alibaba.fastjson.JSONObject"
		resultType="com.battcn.platform.entity.pub.OperateEntity" useCache="false">
		select a.* from t_sys_operate a left join t_sys_role_operate b on
		(a.menu = b.menu and a.op = b.op) left join t_sys_role d on (b.role =
		d.id) left join t_sys_manager f
		on (d.id = f.role) where a.menu =
		#{menu} and f.managerid =#{managerid}
		<if test="op != null and op != ''">
			and a.op = #{op}
		</if>
	</select>



	<select id="getOperatesInPermissionByMenu" parameterType="com.alibaba.fastjson.JSONObject"
		resultType="com.battcn.platform.entity.pub.OperateEntity" useCache="false">
		select a.* from t_sys_operate a left join t_sys_role_operate b on
		(a.menu = b.menu and a.op = b.op) left join t_sys_role d on (b.role =
		d.id) left join t_sys_manager f
		on (d.id = f.role) where a.menu =
		#{menu} and f.managerid =#{managerid}
	</select>
</mapper>